{% extends "base.html" %}
{% block content %}

<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h3 class="mb-1">{% if is_new %}New Rule{% else %}Edit Rule #{{ rule.id }}{% endif %}</h3>
    <div class="text-muted small">Rule definition used by rules_source=db</div>
  </div>
  <div class="text-end">
    <a class="btn btn-outline-secondary btn-sm" href="/rules">
      <i class="bi bi-arrow-left"></i> Back
    </a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">

    <form method="post" action="{% if is_new %}/rules/new{% else %}/rules/{{ rule.id }}{% endif %}" class="vstack gap-3">

      <div class="row g-2">
        <div class="col-12 col-md-6">
          <label class="form-label">Name</label>
          <input class="form-control" name="name" value="{{ rule.name if rule else '' }}" required>
        </div>

        <div class="col-6 col-md-3">
          <label class="form-label">Priority</label>
          <input type="number" class="form-control" name="priority" value="{{ rule.priority if rule else 10 }}" min="0" max="9999">
        </div>

        <div class="col-6 col-md-3">
          <label class="form-label">Active</label>
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="isActive" name="is_active" value="1" {% if rule and rule.is_active %}checked{% endif %}>
            <label class="form-check-label" for="isActive">Enabled</label>
          </div>
        </div>
      </div>

      <div>
        <label class="form-label">Check Command</label>
        <input class="form-control font-monospace" name="check_command" value="{{ rule.check_command if rule else '' }}" required>
        <div class="form-text">مثال: <code>/ip dns print</code></div>
      </div>

      <div>
        <label class="form-label">Warning Regex</label>
        <input class="form-control font-monospace" name="warning_regex" value="{{ rule.warning_regex if rule else '' }}" required>
        <div class="form-text">Regex تُستخدم لاكتشاف التحذير داخل مخرجات check_command.</div>
      </div>

      <div>
        <label class="form-label">Fix Command (optional)</label>
        <textarea class="form-control font-monospace" rows="3" name="fix_command" placeholder="/ip dns set servers=...">{{ rule.fix_command if rule and rule.fix_command else '' }}</textarea>
        <div class="form-text">إذا كانت فارغة: سيتم اعتبار rule فحص فقط.</div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-check2"></i> Save
        </button>
      </div>

    </form>

  </div>
</div>

{% endblock %}
